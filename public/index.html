<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flashcard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>

<div id="navigation"></div>
<div id="main"></div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
<style>
    .hidden {
        display: none !important;
    }
    .active-nav {
        background-color: black;
        color: white !important;
    }
    .card {
        position: relative;
        overflow: hidden;
    }

    .pinyin, .meaning {
        position: absolute;
        left: 0;
        right: 0;
        text-align: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .pinyin {
        bottom: 40px;
        font-size: 1.5rem;
        color: #555;
    }

    .meaning {
        bottom: 10px;
        font-size: 1rem;
        color: gray;
    }

    .card:hover .pinyin, .card:hover .meaning {
        opacity: 1;
    }

    #main {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px; /* Optional: Add spacing from the navbar */
    }
</style>

<script src="https://code.responsivevoice.org/responsivevoice.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navigationDiv = document.getElementById('navigation');
    const mainDiv = document.getElementById('main');

    fetch('/api/dict/index')
      .then(response => response.json())
      .then(data => {
        if (data.length === 0) return;

        const nav = document.createElement('nav');
        nav.className = 'navbar navbar-expand-lg navbar-light bg-light';

        const container = document.createElement('div');
        container.className = 'container-fluid';

        const brand = document.createElement('a');
        brand.className = 'navbar-brand';
        brand.href = '#';
        brand.textContent = 'Dictionaries';
        container.appendChild(brand);

        const toggleButton = document.createElement('button');
        toggleButton.className = 'navbar-toggler';
        toggleButton.type = 'button';
        toggleButton.setAttribute('data-bs-toggle', 'collapse');
        toggleButton.setAttribute('data-bs-target', '#navbarNav');
        toggleButton.innerHTML = '<span class="navbar-toggler-icon"></span>';
        container.appendChild(toggleButton);

        const collapseDiv = document.createElement('div');
        collapseDiv.className = 'collapse navbar-collapse';
        collapseDiv.id = 'navbarNav';

        const navList = document.createElement('ul');
        navList.className = 'navbar-nav';

        data.forEach((item, index) => {
          const navItem = document.createElement('li');
          navItem.className = 'nav-item';

          const navLink = document.createElement('a');
          navLink.className = 'nav-link';
          navLink.href = '#';
          navLink.textContent = item.label;

          navLink.addEventListener('click', (e) => {
            e.preventDefault();
            loadDictionary(item.name);

            // Remove active class from all links
            document.querySelectorAll('.nav-link').forEach(link => {
              link.classList.remove('active-nav');
            });

            // Add active class to the clicked link
            navLink.classList.add('active-nav');
          });

          navItem.appendChild(navLink);
          navList.appendChild(navItem);

          if (index === 0) {
            loadDictionary(item.name);
            navLink.classList.add('active-nav'); // Set the first item as active initially
          }
        });

        collapseDiv.appendChild(navList);
        container.appendChild(collapseDiv);
        nav.appendChild(container);
        navigationDiv.appendChild(nav);
      })
      .catch(error => console.error('Error fetching navigation data:', error));

    function loadDictionary(name) {
      fetch(`/api/dict/${name}`)
        .then(response => response.json())
        .then(dictionary => {
          dictionary.sort((a, b) => a.radical.localeCompare(b.radical));
          mainDiv.innerHTML = '';
          dictionary.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'card text-center';
            card.style.width = '200px';
            card.style.height = '300px';
        card.style.margin = '10px';
        card.style.display = 'inline-block';
            card.style.position = 'relative';

            // Radical element
            const radicalElement = document.createElement('div');
            radicalElement.textContent = entry.radical;
            radicalElement.style.position = 'absolute';
            radicalElement.style.top = '10px';
            radicalElement.style.left = '10px';
            radicalElement.style.color = 'gray';
            radicalElement.style.fontSize = '1rem';

        const charElement = document.createElement('div');
            charElement.textContent = entry.char;
            charElement.style.fontSize = '3rem';
            charElement.style.lineHeight = '300px';
        charElement.style.height = '100%';

        const pinyinElement = document.createElement('div');
        pinyinElement.className = 'pinyin';
            pinyinElement.textContent = entry.pinyin;

        const meaningElement = document.createElement('div');
        meaningElement.className = 'meaning';
            meaningElement.textContent = entry.meaning;

        const pronounceButton = document.createElement('button');
        pronounceButton.textContent = 'ðŸ”Š';
        pronounceButton.style.position = 'absolute';
        pronounceButton.style.top = '10px';
        pronounceButton.style.right = '10px';
        pronounceButton.style.border = 'none';
        pronounceButton.style.background = 'transparent';
        pronounceButton.style.cursor = 'pointer';
        pronounceButton.style.fontSize = '1.5rem';

        pronounceButton.addEventListener('click', () => {
          responsiveVoice.speak(entry.char, "Chinese Female");
        });
        
        const closeButton = document.createElement('button');
        closeButton.textContent = 'âœ–';
        closeButton.style.position = 'absolute';
        closeButton.style.top = '10px';
        closeButton.style.right = '40px';
        closeButton.style.border = 'none';
        closeButton.style.background = 'transparent';
        closeButton.style.cursor = 'pointer';
        closeButton.style.fontSize = '1.5rem';

        closeButton.addEventListener('click', () => {
          setTimeout(() => card.classList.add('hidden'), 1000);
        });
        
        card.appendChild(closeButton);
        card.appendChild(radicalElement);
        card.appendChild(pronounceButton);
        card.appendChild(charElement);
        card.appendChild(pinyinElement);
        card.appendChild(meaningElement);

        mainDiv.appendChild(card);
      });
    })
        .catch(error => console.error('Error fetching dictionary:', error));
    }
  });
</script>

<style>
  /* Floating button styles */
  .floating-button {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .floating-button:hover {
    background-color: #0056b3;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Create the floating button
    const floatingButton = document.createElement('button');
    floatingButton.className = 'floating-button';
    floatingButton.textContent = 'âž°'; // Shuffle icon

    // Append the button to the body
    document.body.appendChild(floatingButton);

    // Add click event listener to shuffle cards
    floatingButton.addEventListener('click', () => {
      const mainDiv = document.getElementById('main');
      const cards = Array.from(mainDiv.children);

      // Shuffle the cards array
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }

      // Re-append the shuffled cards to the main container
      mainDiv.innerHTML = '';
      cards.forEach(card => mainDiv.appendChild(card));
    });
  });
</script>

</body>
</html>